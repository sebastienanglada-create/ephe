<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>√âph√©m√©ride Translucide ‚Äì 2 rue Georges Bizet</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <!-- Chargement de Tailwind CSS pour un style moderne et responsive -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --accent: #387af6;
            --accent2: #9b63e7;
            --fond-clair: #f6faff;
            --fond-nuit: #141b28;
        }

        /* Styles pour le Conteneur Principal (Effet de Verre) */
        .glass-background {
            /* Bordure subtile */
            border: 1px solid rgba(255, 255, 255, 0.2);
            /* Effet flou principal */
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            /* Ombre */
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }

        .dark-mode .glass-background {
            /* Version sombre pour le verre */
            background: linear-gradient(135deg, rgba(36, 44, 61, 0.8) 0%, rgba(53, 62, 79, 0.6) 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
        }

        /* Styles de base pour le corps et le mode sombre */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #182848 0%, #4b6cb7 100%); /* Fond bleu fonc√© par d√©faut */
            color: #e0e7ff;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .dark-mode body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #f1f5f9;
        }

        /* Style sp√©cifique pour le bouton mode sombre */
        #toggle-dark {
            background-color: rgba(255, 255, 255, 0.15);
            color: white;
            transition: background 0.2s;
            backdrop-filter: blur(5px);
        }
        #toggle-dark:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }
        .dark-mode #toggle-dark {
            background-color: rgba(0, 0, 0, 0.3);
        }
        .dark-mode #toggle-dark:hover {
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        /* Styles pour les titres dans le mode sombre */
        .dark-mode h2 {
            color: #a5b4fc; /* Couleur plus claire dans le mode sombre */
        }

        .actus-item {
            border-color: rgba(255, 255, 255, 0.2);
        }
        .dark-mode .actus-item {
            border-color: rgba(0, 0, 0, 0.2);
        }

        /* --- STYLES COMMUNS AUX MODULES D'EN-T√äTE (Date & Calendar) --- */
        .header-module-style {
            /* Fond sombre et opaque (similaire au date-display original) */
            background: rgba(0, 0, 0, 0.3);
            border-radius: 1rem;
            padding: 1.5rem; 
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            /* Hauteur minimale ajust√©e pour r√©duire la taille globale */
            min-height: 180px; 
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        /* NOUVEAU STYLE POUR LA BANNI√àRE (Plus clair et en verre am√©lior√©) */
        .welcome-banner {
            /* Utilisation d'un gradient plus profond pour le fond, mais en gardant la transparence */
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.3) 0%, rgba(255, 255, 255, 0.15) 100%);
            backdrop-filter: blur(25px); /* Plus flou */
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.5); /* Bordure plus visible */
            transition: transform 0.3s ease-out, box-shadow 0.3s ease-out; /* Ajout de transition */
        }
        .welcome-banner:hover {
            transform: translateY(-2px); /* L√©ger soul√®vement au survol */
            box-shadow: 0 15px 40px rgba(255, 255, 255, 0.2); /* Ombre plus marqu√©e */
        }

        .dark-mode .welcome-banner {
            /* Gradient sombre plus riche */
            background: linear-gradient(135deg, rgba(36, 44, 61, 0.8) 0%, rgba(53, 62, 79, 0.6) 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .dark-mode .welcome-banner:hover {
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.7);
        }

        .banner-address-text {
            /* Style pour le texte d'adresse, avec ombre lumineuse */
            text-shadow: 0 0 10px rgba(255, 255, 0, 0.7);
        }

        /* Styles sp√©cifiques pour le grand affichage de la date */
        .date-day-of-week {
            font-size: 1.5rem; /* Taille moyenne */
            font-weight: 700;
            color: #a5b4fc; /* Indigo clair */
        }
        .date-number {
            /* Taille r√©duite de 5rem √† 4rem */
            font-size: 4rem; 
            font-weight: 900;
            line-height: 1;
            color: #ffe082; /* Jaune */
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }
        .date-month-year {
            font-size: 1.25rem;
            font-weight: 500;
            color: #e0e7ff; /* Blanc cass√© */
        }

        .local-contact-card-pharmacy {
            background-color: rgba(16, 185, 129, 0.1); /* Vert clair */
            border-color: rgba(16, 185, 129, 0.5);
            min-height: 140px;
        }
        .local-contact-card-vet {
            background-color: rgba(239, 68, 68, 0.1); /* Rouge clair */
            border-color: rgba(239, 68, 68, 0.5);
            min-height: 140px;
        }
        .local-contact-card-restaurant {
            background-color: rgba(245, 158, 11, 0.1); /* Orange/Amber clair */
            border-color: rgba(245, 158, 11, 0.5);
            min-height: 140px;
        }
        
    </style>
</head>
<body class="dark-mode">

<button id="toggle-dark" class="fixed top-4 right-4 z-50 px-4 py-2 text-sm font-semibold rounded-full shadow-lg">‚òÄÔ∏è Mode jour</button>

<div class="main-container w-full max-w-5xl">
    
    <header class="text-center mb-6 p-4 rounded-xl">
        <!-- NOUVELLE BANNI√àRE DE BIENVENUE (Version Glassmorphism AM√âLIOR√âE) -->
        <div class="welcome-banner p-6 mb-8 rounded-2xl text-center shadow-2xl relative overflow-hidden">
            <!-- Subtil overlay pour la texture (optionnel, mais ajoute de la profondeur) -->
            <div class="absolute inset-0 bg-white/5 opacity-50 pointer-events-none rounded-2xl"></div> 

            <!-- Titre principal -->
            <p class="text-xl sm:text-2xl font-light flex items-center justify-center gap-3 relative z-10 text-indigo-100 mb-2">
                <span class="text-3xl sm:text-4xl text-yellow-300">üè†</span>
                Bienvenue !
            </p>
            
            <!-- Adresse √©lev√©e -->
            <p class="banner-address-text text-3xl sm:text-4xl font-extrabold text-yellow-400 relative z-10 transition duration-300">
                2 rue Georges Bizet
            </p>
            
            <!-- S√©parateur d√©coratif -->
            <div class="w-1/4 h-1 bg-white/30 mx-auto my-3 rounded-full relative z-10"></div>
            
            <p class="text-sm text-white/80 mt-1 relative z-10 italic font-medium">
                Votre guide en temps r√©el des informations pratiques et des services locaux.
            </p>
        </div>
        
        <!-- Conteneur flex pour la date et les infos calendaires -->
        <div class="flex flex-col lg:grid lg:grid-cols-2 justify-center gap-6">

            <!-- MODULE 1: STATIC DATE DISPLAY -->
            <div class="header-module-style flex flex-col items-center mx-auto lg:mx-0 w-full">
                <div id="day-of-week" class="date-day-of-week"></div>
                <div id="date-number" class="date-number"></div>
                <div id="month-year" class="date-month-year"></div>
                <div id="current-time" class="text-lg font-medium mt-2 text-indigo-200"></div>
            </div>

            <!-- MODULE 2: CALENDRIER & CITATION -->
            <section id="calendar-info-module" class="header-module-style mx-auto lg:mx-0 w-full">
                <h2 class="text-xl font-semibold mb-3 text-indigo-200 border-b border-white/20 pb-2 text-center">Calendrier & Citation</h2>
                <div id="calendar-header-content" class="text-sm mt-3 flex flex-col justify-center items-center h-full text-center">
                    <div id="cal-semaine" class="font-bold text-lg text-yellow-300"></div>
                    <div id="cal-days-passes" class="text-white/80"></div>
                    <div id="cal-days-restants" class="text-white/80 mb-2"></div>
                    <!-- Citation plus petite pour rentrer dans l'en-t√™te -->
                    <div id="citation-jour" class="text-xs italic text-indigo-200 p-2 rounded-lg bg-white/5 border border-indigo-500/30 w-full max-w-xs mx-auto mt-2"></div>
                    <div class="update-time text-xs text-white/70 pt-2" id="calendrier-update"></div>
                </div>
            </section>

        </div>
    </header>

    <!-- Le Conteneur principal translucide au centre -->
    <div class="glass-background p-6 md:p-10 rounded-3xl shadow-2xl mx-auto w-full">

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 lg:gap-10">
            
            <!-- Colonne Gauche : CONTEXTE QUOTIDIEN (M√©t√©o en premier) -->
            <div class="col space-y-6">

                <!-- MODULE: M√âT√âO LOCALE -->
                <section id="meteo-module" class="bg-white/10 p-6 rounded-2xl border border-white/20 hover:shadow-xl transition duration-300">
                    <h2 class="text-2xl font-semibold mb-4 text-indigo-400">M√©t√©o Locale</h2>
                    <!-- Contenu m√©t√©o sans ic√¥ne, centr√©. Augmentation de la taille pour compenser la perte des actus -->
                    <div id="weather-content" class="text-center font-medium mb-4 text-xl py-4">Chargement m√©t√©o...</div>
                    <div class="update-time text-sm text-white/70 text-right" id="meteo-update"></div>
                </section>

                <!-- MODULE: LUNE & LUMINOSIT√â (Maintenant en deuxi√®me position) -->
                <section id="sun-moon-details" class="bg-white/10 p-6 rounded-2xl border border-white/20 hover:shadow-xl transition duration-300">
                    <h2 class="text-2xl font-semibold mb-4 text-indigo-400">Lune & Luminosit√©</h2>
                    <div id="sun-moon-content-main" class="grid grid-cols-3 gap-4 text-center mt-3 text-base">
                        <!-- Phase Lunaire -->
                        <div>
                            <div class="text-4xl mb-1" id="moon-phase-icon">...</div>
                            <div class="font-semibold text-white/90 text-sm">Phase</div>
                            <div id="moon-phase-name" class="text-yellow-300 font-bold text-sm">Chargement...</div>
                        </div>
                        <!-- Lever du soleil -->
                        <div>
                            <div class="text-4xl mb-1">üåÖ</div>
                            <div class="font-semibold text-white/90 text-sm">Lever du soleil</div>
                            <div id="sunrise-time" class="text-yellow-300 font-bold text-xl mt-1">...</div>
                        </div>
                        <!-- Coucher du soleil -->
                        <div>
                            <div class="text-4xl mb-1">üåá</div>
                            <div class="font-semibold text-white/90 text-sm">Coucher du soleil</div>
                            <div id="sunset-time" class="text-yellow-300 font-bold text-xl mt-1">...</div>
                        </div>
                    </div>
                    <div class="update-time text-sm text-white/70 pt-4 text-right" id="sun-moon-update"></div>
                </section>

                <!-- PROCHAIN JOUR F√âRI√â -->
                <section id="prochain-ferie-section" class="bg-white/10 p-6 rounded-2xl border border-white/20 hover:shadow-xl transition duration-300">
                    <h2 class="text-2xl font-semibold mb-4 text-indigo-400">Prochain jour f√©ri√©</h2>
                    <div id="prochain-ferie-card" class="info-card p-3 rounded-xl bg-white/5 border border-white/10 text-center">
                        <div class="text-3xl mb-1">üìÖ</div>
                        <div class="font-semibold text-indigo-300">Date √† planifier</div>
                        <div id="ferie-nom" class="text-sm font-bold text-yellow-300">Chargement...</div>
                        <div id="ferie-date" class="text-xs"></div>
                        <div id="ferie-temps-restant" class="text-xs mt-1 text-white/70"></div>
                    </div>
                </section>
                
                <!-- VACANCES SCOLAIRES (Planification √† long terme) -->
                <section id="vacances" class="bg-white/10 p-6 rounded-2xl border border-white/20 hover:shadow-xl transition duration-300">
                    <h2 class="text-2xl font-semibold mb-4 text-indigo-400">Vacances scolaires (2025/2026)</h2>
                    <div id="zone-btns" class="flex gap-2 justify-center mb-4">
                        <button class="zone-btn px-4 py-1 text-sm rounded-xl font-medium bg-indigo-500 text-white hover:bg-indigo-600 transition duration-150" data-zone="A">Zone A</button>
                        <button class="zone-btn px-4 py-1 text-sm rounded-xl font-medium bg-white/10 text-white hover:bg-white/20 transition duration-150" data-zone="B">Zone B</button>
                        <button class="zone-btn px-4 py-1 text-sm rounded-xl font-medium bg-white/10 text-white hover:bg-white/20 transition duration-150" data-zone="C">Zone C</button>
                    </div>
                    <ul id="vacances-list" class="space-y-2 text-center"></ul>
                </section>
                
            </div>

            <!-- Colonne Droite : Services Locaux -->
            <div class="col space-y-6">

                <!-- CONTACTS LOCAUX (3 services) -->
                <section id="local-contacts" class="bg-white/10 p-6 rounded-2xl border border-white/20 hover:shadow-xl transition duration-300">
                    <h2 class="text-2xl font-semibold mb-6 text-yellow-400 border-b border-yellow-400/50 pb-2">Contacts Commerces</h2>
                    <!-- RESTAUR√â : Utilisation de grid-cols-1 lg:grid-cols-2 pour afficher 2 contacts par ligne sur desktop -->
                    <div class="info-grid grid grid-cols-1 lg:grid-cols-2 gap-4 w-full">
                        
                        <!-- Pharmacie Locale -->
                        <div class="info-card p-3 rounded-xl local-contact-card-pharmacy border min-h-[140px] text-center">
                            <div class="text-3xl mb-1">üíä</div>
                            <div class="font-semibold text-green-300">Pharmacie de la Moulette</div>
                            <div class="text-xs text-white/80 italic mb-1">102 Av. Pasteur, 24100 Bergerac</div>
                            <!-- Num√©ro de t√©l√©phone recherch√© -->
                            <a href="tel:0553570469" class="text-2xl font-bold text-yellow-300 hover:text-yellow-200 transition mt-1 block">05 53 57 04 69</a>
                            <span class="text-xs mt-1 text-white/70 font-medium block">
                                Horaires : Lundi‚ÄìSamedi : 9h‚Äì12h30 / 14h‚Äì19h30
                            </span>
                        </div>
                        
                        <!-- V√©t√©rinaire Local -->
                        <div class="info-card p-3 rounded-xl local-contact-card-vet border min-h-[140px] text-center">
                            <div class="text-3xl mb-1">üê∂</div>
                            <div class="font-semibold text-red-300">Clinique v√©t√©rinaire Ali√©nor</div>
                            <div class="text-xs text-white/80 italic mb-1">Consultations sur rendez-vous</div>
                            <!-- Num√©ro du v√©t√©rinaire -->
                            <a href="tel:0553570805" class="text-2xl font-bold text-red-400 hover:text-red-300 transition mt-1 block">05 53 57 08 05</a>
                            <span class="text-xs mt-1 text-white/70 font-medium block">
                                Lundi‚ÄìVendredi 8h‚Äì12h30, 14h‚Äì19h, Samedi 8h‚Äì12h
                            </span>
                            <div class="text-xs mt-1 text-white/70 font-medium block">
                                *Urgences : Suivre les instructions du r√©pondeur.
                            </div>
                        </div>

                        <!-- Restaurant C‚Äôest Qui L‚ÄôPaton - Prend maintenant toute la ligne sur mobile/tablet, et la moiti√© sur desktop (lg:col-span-2 retir√©) -->
                        <div class="info-card p-3 rounded-xl local-contact-card-restaurant border min-h-[140px] text-center lg:col-span-2">
                            <div class="text-3xl mb-1">üçΩÔ∏è</div>
                            <div class="font-semibold text-orange-300">C‚Äôest Qui L‚ÄôPaton</div>
                            <div class="text-xs text-white/80 italic mb-1">3 Avenue Marceau Feyry, 24100 Bergerac</div>
                            <!-- Nouveau Num√©ro -->
                            <a href="tel:0553733721" class="text-2xl font-bold text-orange-400 hover:text-orange-300 transition mt-1 block">05 53 73 37 21</a>
                            <span class="text-xs mt-1 text-white/70 font-medium block">
                                Ouvert Lundi‚ÄìSamedi (midi & soir). Ferm√© le dimanche midi.
                            </span>
                        </div>
                    </div>
                </section>


                <!-- ADRESSES UTILES (Statiques) -->
                <section id="adresses" class="bg-white/10 p-6 rounded-2xl border border-white/20 hover:shadow-xl transition duration-300">
                    <h2 class="text-2xl font-semibold mb-6 text-indigo-400">Adresses & Services essentiels</h2>
                    <div class="info-grid grid grid-cols-2 gap-4 w-full">
                        <!-- Mairie -->
                        <div class="info-card p-3 rounded-xl bg-white/5 border border-white/10 text-center">
                            <div class="text-3xl mb-1">üèõÔ∏è</div>
                            <div class="font-semibold text-indigo-300">Mairie</div>
                            <div class="text-sm">106 rue Neuve d'Argenson</div>
                            <a href="tel:0553746666" class="text-sm font-bold text-yellow-300 hover:text-yellow-200 transition">05 53 74 66 66</a>
                        </div>
                        <!-- Police -->
                        <div class="info-card p-3 rounded-xl bg-white/5 border border-white/10 text-center">
                            <div class="text-3xl mb-1">üöì</div>
                            <div class="font-semibold text-indigo-300">Police municipale</div>
                            <div class="text-sm">19 rue Neuve d'Argenson</div>
                            <a href="tel:0553746622" class="text-sm font-bold text-yellow-300 hover:text-yellow-200 transition">05 53 74 66 22</a>
                        </div>
                        <!-- H√¥pital -->
                        <div class="info-card p-3 rounded-xl bg-white/5 border border-white/10 text-center">
                            <div class="text-3xl mb-1">üè•</div>
                            <div class="font-semibold text-indigo-300">H√¥pital</div>
                            <div class="text-sm">9 av. Calmette</div>
                            <a href="tel:0553638888" class="text-sm font-bold text-yellow-300 hover:text-yellow-200 transition">05 53 63 88 88</a>
                        </div>
                        <!-- Tourisme -->
                        <div class="info-card p-3 rounded-xl bg-white/5 border border-white/10 text-center">
                            <div class="text-3xl mb-1">üß≠</div>
                            <div class="font-semibold text-indigo-300">Office de tourisme</div>
                            <div class="text-sm">Quai Cyrano</div>
                            <a href="tel:0553570311" class="text-sm font-bold text-yellow-300 hover:text-yellow-200 transition">05 53 57 03 11</a>
                        </div>
                    </div>
                </section>
                
            </div>
        </div>
    </div>
</div>

<script>
// Coordonn√©es de Bergerac
const LAT = 44.8516;
const LON = 0.4817;

// Configuration des variables globales de l'environnement (initialisation Firestore non utilis√©e ici)
const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
// FIX: Correction de la faute de frappe: __firebaseConfig a √©t√© remplac√© par __firebase_config
const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : '';


// Initialisation Tailwind pour g√©rer les classes
tailwind.config = {
    darkMode: 'class', // Active le mode sombre bas√© sur la classe 'dark-mode' sur <body>
}

// =========================================================
// === FONCTIONS STATIQUES/SEMI-STATIQUES ===
// =========================================================


// === STATIC DATE & TIME LOGIC ===
function updateDateTime() {
    const now = new Date();
    
    // JOUR DE LA SEMAINE (Vendredi)
    const dayOfWeek = now.toLocaleDateString('fr-FR', { weekday: 'long' });
    document.getElementById('day-of-week').textContent = dayOfWeek.charAt(0).toUpperCase() + dayOfWeek.slice(1);
    
    // NUM√âRO DU JOUR (3)
    document.getElementById('date-number').textContent = now.getDate();
    
    // MOIS ET ANN√âE (Octobre 2025)
    const monthYear = now.toLocaleDateString('fr-FR', { month: 'long', year: 'numeric' });
    document.getElementById('month-year').textContent = monthYear.charAt(0).toUpperCase() + monthYear.slice(1);

    // HEURE (Pour rester dynamique et utile)
    const time = now.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
    document.getElementById('current-time').textContent = `Heure locale : ${time}`;
}

// Mise √† jour de l'heure chaque seconde
setInterval(updateDateTime, 1000);
// =========================================================

// === LUNE & SOLEIL ===

/**
 * Met √† jour la phase lunaire (approximation bas√©e sur le jour de l'ann√©e)
 */
function updateMoonPhase() {
    const now = new Date();
    // Approximation simplifi√©e du cycle lunaire (29.53 jours)
    // Utilisation d'une date de Nouvelle Lune proche de 2000 comme point de d√©part
    const start2000 = new Date('2000-01-06'); 
    const diffDays = (now - start2000) / (1000 * 60 * 60 * 24);
    // Le cycle lunaire synodique est d'environ 29.530588 jours
    const lunarCycleDay = diffDays % 29.5305882;
    
    let phaseName = "";
    let phaseIcon = "";

    // 0 = Nouvelle Lune, 14.76 = Pleine Lune
    if (lunarCycleDay < 1.84) {
        phaseName = "Nouvelle Lune"; phaseIcon = "üåë";
    } else if (lunarCycleDay < 5.53) {
        phaseName = "Premier Croissant"; phaseIcon = "üåí";
    } else if (lunarCycleDay < 9.22) {
        phaseName = "Premier Quartier"; phaseIcon = "üåì";
    } else if (lunarCycleDay < 12.91) {
        phaseName = "Lune Gibbeuse Croissante"; phaseIcon = "üåî";
    } else if (lunarCycleDay < 16.61) {
        phaseName = "Pleine Lune"; phaseIcon = "üåï";
    } else if (lunarCycleDay < 20.30) {
        phaseName = "Lune Gibbeuse D√©croissante"; phaseIcon = "üåñ";
    } else if (lunarCycleDay < 23.99) {
        phaseName = "Dernier Quartier"; phaseIcon = "üåó";
    } else if (lunarCycleDay < 27.68) {
        phaseName = "Dernier Croissant"; phaseIcon = "üåò";
    } else {
        phaseName = "Nouvelle Lune"; phaseIcon = "üåë";
    }

    // Mise √† jour des √©l√©ments dans le module #sun-moon-details
    document.getElementById('moon-phase-name').textContent = phaseName;
    document.getElementById('moon-phase-icon').textContent = phaseIcon;
    document.getElementById('sun-moon-update').textContent = 'MAJ : ' + new Date().toLocaleTimeString('fr-FR');
}

/**
 * R√©cup√®re les heures de lever et coucher du soleil via Open-Meteo
 */
async function fetchSunData() {
    const url = `https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&daily=sunrise,sunset&timezone=Europe%2FParis`;
    try {
        const r = await fetch(url);
        const d = await r.json();
        
        const sunriseStr = d.daily?.sunrise?.[0] || null;
        const sunsetStr = d.daily?.sunset?.[0] || null;

        if (sunriseStr && sunsetStr) {
            // Extraire l'heure (HH:MM)
            const sunriseTime = new Date(sunriseStr).toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
            const sunsetTime = new Date(sunsetStr).toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });

            // Mise √† jour des √©l√©ments dans le module #sun-moon-details
            document.getElementById('sunrise-time').textContent = sunriseTime;
            document.getElementById('sunset-time').textContent = sunsetTime;
        } else {
            throw new Error("Donn√©es soleil incompl√®tes.");
        }
    } catch (e) {
        console.error("Erreur soleil:", e);
        document.getElementById('sunrise-time').textContent = "Erreur";
        document.getElementById('sunset-time').textContent = "Erreur";
    }
}
// =========================================================


// === M√âT√âO (Open-Meteo) ===
async function fetchWeather() {
¬†   // Coordonn√©es de Bergerac (Latitude: 44.8516, Longitude: 0.4817)
    // Seules les donn√©es n√©cessaires (temp√©rature et pr√©cipitation) sont demand√©es.
¬†   const url = `https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}&hourly=temperature_2m,precipitation&current_weather=true&timezone=Europe%2FParis`;
¬†   try {
¬† ¬†   const r = await fetch(url);
¬† ¬†   const d = await r.json();
¬† ¬†   const meteo = d.current_weather;
¬† ¬†   
        const temp = meteo ? `${meteo.temperature}¬∞C` : "--";
¬† ¬†   const pluie = (typeof d.hourly.precipitation[0] !== "undefined") ? 
          `<br>Pr√©cipitations (proch. h) : <b class="text-yellow-400">${d.hourly.precipitation[0]} mm</b>` : ""; 

        // Mise √† jour du contenu textuel de la m√©t√©o
¬† ¬†   document.getElementById('weather-content').innerHTML =
¬† ¬† ¬†   `Temp√©rature actuelle : <b class="text-yellow-400">${temp}</b>${pluie}`;

¬† ¬†   document.getElementById('meteo-update').textContent = 'MAJ : ' + new Date().toLocaleTimeString('fr-FR');
¬†   } catch (e) {
¬† ¬†   console.error("Erreur m√©t√©o:", e);
¬† ¬†   document.getElementById('weather-content').textContent = "Erreur de chargement m√©t√©o.";
¬†   }
}


// === VACANCES SCOLAIRES (2025/2026 - Bergerac est en Zone A) ===
const vacancesZones = {
¬†   "A": [
¬† ¬†   { nom: "Toussaint", debut: "25/10/2025", fin: "03/11/2025" },
¬† ¬†   { nom: "No√´l", debut: "20/12/2025", fin: "05/01/2026" },
¬† ¬†   { nom: "Hiver", debut: "21/02/2026", fin: "09/03/2026" },
¬† ¬†   { nom: "Printemps", debut: "18/04/2026", fin: "04/05/2026" },
¬† ¬†   { nom: "√ât√©", debut: "04/07/2026", fin: "01/09/2026" }
¬†   ],
¬†   "B": [
¬† ¬†   { nom: "Toussaint", debut: "25/10/2025", fin: "03/11/2025" },
¬† ¬†   { nom: "No√´l", debut: "20/12/2025", fin: "05/01/2026" },
¬† ¬†   { nom: "Hiver", debut: "07/02/2026", fin: "23/02/2026" },
¬† ¬†   { nom: "Printemps", debut: "04/04/2026", fin: "20/04/2026" },
¬† ¬†   { nom: "√ât√©", debut: "04/07/2026", fin: "01/09/2026" }
¬†   ],
¬†   "C": [
¬† ¬†   { nom: "Toussaint", debut: "25/10/2025", fin: "03/11/2025" },
¬† ¬†   { nom: "No√´l", debut: "20/12/2025", fin: "05/01/2026" },
¬† ¬†   { nom: "Hiver", debut: "07/03/2026", fin: "23/03/2026" },
¬† ¬†   { nom: "Printemps", debut: "25/04/2026", fin: "11/05/2026" },
¬† ¬†   { nom: "√ât√©", debut: "04/07/2026", fin: "01/09/2026" }
¬†   ]
};

let currentZone = "A"; // Bergerac est en Zone A

function displayVacances(zone) {
    const list = document.getElementById('vacances-list');
    list.innerHTML = '';
    const now = new Date();

    vacancesZones[zone].forEach(vac => {
        const [d, m, y] = vac.debut.split('/').map(n => parseInt(n, 10));
        const debut = new Date(y, m - 1, d); // Les mois JS sont 0-index√©s

        let status = '';
        let statusClass = 'text-white/80';

        if (debut > now) {
            const diffTime = debut - now;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            status = `(dans ${diffDays} j.)`;
            statusClass = 'text-green-300 font-bold';
        } else {
            // Check if we are currently in vacation
            const [df, mf, yf] = vac.fin.split('/').map(n => parseInt(n, 10));
            const fin = new Date(yf, mf - 1, df);
            if (now >= debut && now <= fin) {
                status = `(EN COURS) - Fin le ${vac.fin}`;
                statusClass = 'text-red-300 font-bold';
            } else {
                status = '(Pass√©es)';
                statusClass = 'text-white/50 italic';
            }
        }

        const item = document.createElement('li');
        item.className = 'flex justify-between items-center text-sm border-b border-white/10 pb-1 last:border-b-0';
        item.innerHTML = `
            <span class="font-medium text-indigo-200">${vac.nom}</span>
            <span class="${statusClass} text-xs md:text-sm">${vac.debut} au ${vac.fin} ${status}</span>
        `;
        list.appendChild(item);
    });
}

function initVacances() {
    // Initial display
    displayVacances(currentZone);

    // Event listeners for zone buttons
    const zoneBtns = document.querySelectorAll('.zone-btn');
    zoneBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            // Update active state
            zoneBtns.forEach(b => {
                b.classList.remove('bg-indigo-500', 'hover:bg-indigo-600');
                b.classList.add('bg-white/10', 'hover:bg-white/20');
            });
            btn.classList.add('bg-indigo-500', 'hover:bg-indigo-600');
            btn.classList.remove('bg-white/10', 'hover:bg-white/20');
            
            // Update content
            currentZone = btn.dataset.zone;
            displayVacances(currentZone);
        });
    });
}
// =========================================================

// === JOURS F√âRI√âS (2025/2026) ===
// Mise √† jour de la liste pour inclure la fin 2025 (√† partir de maintenant, 3 oct 2025) et 2026.
const feries = [
    // Reste de 2025 (apr√®s le 3 octobre)
    { nom: "Toussaint", date: "01/11/2025" },
    { nom: "Armistice 1918", date: "11/11/2025" },
    { nom: "No√´l", date: "25/12/2025" },
    // Ann√©e 2026
    { nom: "Jour de l'An", date: "01/01/2026" },
    { nom: "Lundi de P√¢ques", date: "06/04/2026" },
    { nom: "F√™te du Travail", date: "01/05/2026" },
    { nom: "Victoire 1945", date: "08/05/2026" },
    { nom: "Ascension", date: "14/05/2026" },
    { nom: "Lundi de Pentec√¥te", date: "25/05/2026" },
    { nom: "F√™te Nationale", date: "14/07/2026" },
    { nom: "Assomption", date: "15/08/2026" },
    { nom: "Toussaint", date: "01/11/2026" },
    { nom: "Armistice 1918", date: "11/11/2026" },
    { nom: "No√´l", date: "25/12/2026" }
];

function calculateNextFerie() {
    const now = new Date();
    // On met l'heure √† 00:00:00 pour comparer uniquement les jours
    now.setHours(0, 0, 0, 0); 

    let prochainFerie = null;
    let minDiff = Infinity;

    // Convertit une date DD/MM/YYYY en objet Date
    const parseDate = (dateStr) => {
        const [d, m, y] = dateStr.split('/').map(n => parseInt(n, 10));
        // Les mois JS sont 0-index√©s (m-1)
        const dateObj = new Date(y, m - 1, d); 
        // Assurez-vous que l'heure est minuit pour la comparaison
        dateObj.setHours(0, 0, 0, 0); 
        return dateObj;
    };

    for (const ferie of feries) {
        let ferieDate = parseDate(ferie.date);
        
        const diff = ferieDate - now;

        // Si la diff√©rence est positive ou nulle (jour J), c'est un jour f√©ri√© futur ou actuel.
        if (diff >= 0 && diff < minDiff) {
            minDiff = diff;
            prochainFerie = ferie;
            prochainFerie.objDate = ferieDate;
        }
    }

    const ferieNomEl = document.getElementById('ferie-nom');
    const ferieDateEl = document.getElementById('ferie-date');
    const ferieTempsRestantEl = document.getElementById('ferie-temps-restant');

    if (prochainFerie) {
        const joursRestants = Math.ceil(minDiff / (1000 * 60 * 60 * 24));
        ferieNomEl.textContent = prochainFerie.nom;
        ferieDateEl.textContent = prochainFerie.date;
        
        if (joursRestants === 0) {
            ferieTempsRestantEl.textContent = "AUJOURD'HUI ! Profitez-en !";
            ferieTempsRestantEl.classList.remove('text-white/70');
            ferieTempsRestantEl.classList.add('text-red-400', 'font-extrabold');
        } else if (joursRestants === 1) {
            ferieTempsRestantEl.textContent = "C'est DEMAIN ! Pr√©parez-vous !";
            ferieTempsRestantEl.classList.add('text-white/70');
            ferieTempsRestantEl.classList.remove('text-red-400', 'font-extrabold');
        } else {
            ferieTempsRestantEl.textContent = `Plus que ${joursRestants} jours !`;
            ferieTempsRestantEl.classList.add('text-white/70');
            ferieTempsRestantEl.classList.remove('text-red-400', 'font-extrabold');
        }
    } else {
        ferieNomEl.textContent = "Fin de la liste des jours f√©ri√©s.";
        ferieDateEl.textContent = "";
        ferieTempsRestantEl.textContent = "Veuillez mettre √† jour la liste pour l'ann√©e prochaine.";
    }
}
// =========================================================

// === CALENDRIER (Saints, Jours √©coul√©s) ===
function updateCalendarInfo() {
    const now = new Date();
    const startOfYear = new Date(now.getFullYear(), 0, 1);
    
    // Calcul de la semaine et des jours
    const oneDay = 1000 * 60 * 60 * 24;
    const dayOfYear = Math.floor((now - startOfYear) / oneDay) + 1;
    const weekNumber = Math.ceil((dayOfYear + startOfYear.getDay() - 1) / 7);
    const totalDays = now.getFullYear() % 4 === 0 ? 366 : 365;
    const daysRemaining = totalDays - dayOfYear;
    
    // Liste des Saints (simplifi√©e pour l'exemple)
    const saints = [
        "Octave", "Th√©r√®se", "G√©rard", "Fran√ßois", "Fleur", "Bruno", "Serge", "P√©lagie", 
        "Denis", "Ghislain", "Firmin", "Wilfrid", "G√©raud", "Juste", "Th√©r√®se d'Avila", 
        "Edwige", "Baudouin", "Luc", "Ren√©", "Adeline", "C√©line", "Elodie", "Jean de Capistran", 
        "Florentin", "Cr√©pin", "Dimitri", "Emeline", "Simon", "Narcisse", "Bienvenue", "Quentin", 
        "Toussaint", "Hubert", "Charles", "Sylvie", "L√©onard", "Bertille", "Carine", "Achille", 
        "Th√©odore", "Christian", "Martin", "Beno√Æt", "Sidoine", "Albert", "Marguerite", "Elisabeth", 
        "Pr√©sence", "Edmond", "Rufin", "Catherine", "Delphine", "S√©verin", "Jacques", "Andr√©", 
        "Florence", "Barbara", "Nicolas", "G√©rald", "Ambroise", "Perrine", "Conception", "Auxence", 
        "Daniel", "Mireille", "Gatien", "No√´l"
    ]; 
    const saintJour = saints[(now.getMonth() * 31 + now.getDate()) % saints.length]; // Approximation

    // Mise √† jour de l'affichage
    document.getElementById('cal-semaine').textContent = `Nous sommes la Semaine n¬∞${weekNumber}.`;
    document.getElementById('cal-days-passes').textContent = `Jour √©coul√© : ${dayOfYear} / ${totalDays} (Sainte : ${saintJour})`;
    document.getElementById('cal-days-restants').textContent = `Jours restants en ${now.getFullYear()} : ${daysRemaining}`;
    document.getElementById('calendrier-update').textContent = 'MAJ : ' + new Date().toLocaleTimeString('fr-FR');
}
// =========================================================

// === CITATION DU JOUR (Statique) ===
function setCitation() {
    const citations = [
        "La vie est un myst√®re qu'il faut vivre, et non un probl√®me √† r√©soudre. - Gandhi",
        "Le plus grand risque est de ne prendre aucun risque. - Mark Zuckerberg",
        "Il n'y a qu'une fa√ßon d'√©chouer, c'est d'abandonner avant d'avoir r√©ussi. - Georges Clemenceau",
        "L'action n'est pas seulement l'expression d'une pens√©e, elle en est aussi la formation. - Paul Val√©ry",
        "Le succ√®s n'est pas final, l'√©chec n'est pas fatal : c'est le courage de continuer qui compte. - Winston Churchill",
        "Le secret du changement, c'est de concentrer toute son √©nergie non pas √† lutter contre le pass√©, mais √† construire l'avenir. - Socrate"
    ];
    // Utiliser le jour de l'ann√©e pour choisir une citation unique chaque jour
    const now = new Date();
    const start = new Date(now.getFullYear(), 0, 0);
    const diff = now - start;
    const oneDay = 1000 * 60 * 60 * 24;
    const dayOfYear = Math.floor(diff / oneDay);
    
    const citation = citations[dayOfYear % citations.length];
    document.getElementById('citation-jour').textContent = `¬´ ${citation} ¬ª`;
}
// =========================================================


// === MODE SOMBRE & INITIALISATION ===
function setupDarkModeToggle() {
    const body = document.body;
    const toggleBtn = document.getElementById('toggle-dark');

    // Initialisation par d√©faut au mode sombre
    body.classList.add('dark-mode');
    toggleBtn.textContent = '‚òÄÔ∏è Mode jour';

    toggleBtn.addEventListener('click', () => {
        if (body.classList.contains('dark-mode')) {
            body.classList.remove('dark-mode');
            toggleBtn.textContent = 'üåô Mode nuit';
        } else {
            body.classList.add('dark-mode');
            toggleBtn.textContent = '‚òÄÔ∏è Mode jour';
        }
    });
}

// Lancement de toutes les fonctions d'initialisation
window.onload = function() {
    setupDarkModeToggle();
    updateDateTime();
    updateMoonPhase(); // Mise √† jour statique de la lune
    fetchSunData();    // R√©cup√©ration des heures de soleil
    fetchWeather();    // R√©cup√©ration de la m√©t√©o
    initVacances();    // Initialisation des vacances (Zone A par d√©faut)
    calculateNextFerie(); // Calcul du prochain jour f√©ri√©
    updateCalendarInfo(); // Mise √† jour des infos calendrier/saints
    setCitation();     // D√©finition de la citation

    // Rafra√Æchissement des donn√©es dynamiques (m√©t√©o) toutes les heures
    setInterval(fetchWeather, 3600000); // 1 heure
    
    // Rafra√Æchissement des donn√©es de date, lune et f√©ri√©s chaque jour
    setInterval(() => {
        updateDateTime();
        updateMoonPhase();
        fetchSunData();
        calculateNextFerie();
        updateCalendarInfo();
        setCitation();
        displayVacances(currentZone);
    }, 86400000); // 24 heures

    // Rafra√Æchissement de l'heure toutes les 5 secondes (pour l'affichage statique)
    setInterval(updateDateTime, 5000);
};

</script>
</body>
</html>
